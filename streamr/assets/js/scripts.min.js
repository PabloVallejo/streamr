//
//  Application config file
//

window.App = {
  		Handlers: {}
 	,	Models: {}
  	,	Controllers: {}
  	,	Views: {}
  	,	Helpers: {}
};
//
// Helper: Utilities
//
( function( $, window, document ) {

	var Utils = function() {

	}

	Utils.prototype = {

			/**
            * Converts hiphens to underscores
            */
            hyphenToUnderscore: function( string ) {
                return string.replace( /([-])/g, function( $1 ) {

                    return "_";

                });
            }


        	/**
            * Maps form inputs generated when using serializeArray();
            * pusshes them to an array in a key( name ) value( value ) structure
            *
            * @param { array } serializeArray() generated array
            * @return { array } mapped array
            *
            */
        ,   mapFormInputs: function( data, type, dropEmpty ) {

                var formData = type || []
                ,   _this = this;

                $.each( data, function( key, val ) {

                    replaced = _this.hyphenToUnderscore( val.name );

                    if ( dropEmpty ) {

                        if ( val.value != "" ) {
                            formData[ replaced ] = val.value;
                        }

                        new Image()
                    }

                    else {
                        formData[ replaced ] = val.value;
                    }

                });

                return formData;

            }


			/**
            * Gets the form data
            * @param { obj || str } form object or selector
            * @return { obj } mapped form
            */
        ,   getFormData: function( form, dropEmpty ) {

                var data
                ,   _this = this;

                if ( dropEmpty == null ) {
                    dropEmpty = true;
                }

                data = $( form ).serializeArray();
                data = this.mapFormInputs( data, {}, dropEmpty );

                $.each( data, function( key, value ) {
                    if ( value == "on" ) {
                        data[ key ] = true;
                    }
                });

                // Check for empty values
                $( form ).find( "input[type=checkbox]" ).each( function() {
                    if ( ! $( this ).is( ":checked" ) ) {
                        name = $( this ).attr( "name" );
                        name = _this.hyphenToUnderscore( name );
                        data[ name ] = false;
                    }

                });

                return data;

            }

            /**
            * Helps in the process of making a ajax requests
            *
            * @param { object } Options for configuring the ajax request
            * @param { object } data object to be sent
            */
        ,   ajax: function( options, data ) {

                var result
                ,   defaults = {
                        type: 'post'
                    // ,   url: aUrl
                    ,   data: data
                    ,   async: false
                    ,   success: function( data ) {
                                result = data;
                        }

                    ,   error: function ( XMLHttpRequest, textStatus, errorThrown ) {
                                console.log( "error :" + XMLHttpRequest.responseText );
                        }
                    }

                // Merge defaults and options
                options = $.extend( {}, defaults, options );

                // Do the ajax request
                $.ajax( options );

                // Return the response object
                return result;

            }

	};

	// Global exposition
	window.App.Helpers.Utils = new Utils();

})( jQuery, this, this.document );
/**
*
* Model User
*/
( function( $, window, document, utils ) {

	var User = function( a ) {

		// Class attributes can be set here
	}

	User.prototype = {

			login: function( creds ) {

				var data = {
						creds: creds
					}
				,	options = {
							async: true
						,	url: '/login'
						,	success: function( data ) {

								console.log( data );
							}	
					}

				return utils.ajax( options, data );
			}

	}

	// Global Exposition
	window.App.Models.User = new User();



})( this.jQuery, this, this.document, this.App.Helpers.Utils, undefined );


/**
*
* View User
*/
( function( $, window, document, utilities ) {

	var User = function( a ) {

		// Class attributes can be set here

	}

	User.prototype = {


	}

	// Global Exposition
	window.App.Views.User = new User();



})( this.jQuery, this, this.document, this.App.Helpers.Utilities, undefined );


/**
*
* Controller: User
*/
( function( $, window, document, view, model, utils ) {

	var User = function( a ) {

		// Class attributes can be set here
	}

	User.prototype = {

			// Login
			login: function( data ) {
				model.login( data );						
			}

	}

	// Global Exposition
	window.App.Controllers.User = new User();



})( this.jQuery, this, this.document, this.App.Views.User, this.App.Models.User, this.App.Helpers.Utils, undefined );


/**
*
* Handler User
*/
( function( $, window, document, view, controller, utils ) {


	var User = Gillie.extend({

			// Initialize
			initialize: function()  {
				console.log( 'Gillie' );
			}

		,	events: {
				'submit .login-page .login-form': 'login'
			}


			// Login 
		,	login: function( e ) {
				e.preventDefault();
				data = utils.getFormData( e.currentTarget );
				return controller.login( data );
			}


	});


	// Global Exposition
	window.App.Handlers.User = new User();



})( this.jQuery, this, this.document, this.App.Views.User, this.App.Controllers.User, this.App.Helpers.Utils, undefined );


(function() {



}).call(this);
